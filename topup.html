<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nạp tiền - Metro</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>

<body>
  <div class="header">
    <h1>Nạp tiền cho thẻ</h1>
    <a href="index.html" class="btn">Dashboard</a>
  </div>

  <div class="card" style="max-width:600px; margin: 12px auto;">
    <div class="form-row">
      <input id="uid" class="input" placeholder="UID thẻ (VD: UID_001)">
      <input id="amount" class="input" placeholder="Số tiền (VND)">
      <button id="topup" class="btn">Nạp</button>
    </div>
    <div id="message" class="small" style="margin-top:10px;"></div>
  </div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://metrosystem-c3170-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  document.getElementById("topup").addEventListener("click", async () => {
    const uid = document.getElementById("uid").value.trim();
    const amount = Number(document.getElementById("amount").value);
    const msg = document.getElementById("message");

    if (!uid || amount <= 0) {
      msg.textContent = "Nhập UID và số tiền hợp lệ";
      return;
    }

    const ref = db.ref("metro/cards/" + uid);
    const snap = await ref.once("value");
    let card = snap.val() || { balance: 0 };

    card.balance += amount;
    card.last_topup = Math.floor(Date.now() / 1000);

    await ref.set(card);
    msg.textContent = "Nạp thành công! Số dư mới: " + card.balance + " VND";
  });
</script>
</body>
</html>
